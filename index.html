<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- PapaParse (CSV parser) -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<!-- Optional: Leaflet Control Geocoder for general search -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<!-- Map container -->
<div id="map" style="width:100%; height:600px;"></div>

<script>
  // Initialize the map to continental US
  const map = L.map("map");
  const continentalUSBounds = [
    [24.396308, -124.848974],
    [49.384358, -66.885444]
  ];
  map.fitBounds(continentalUSBounds);

  // Mapbox grayscale basemap
  L.tileLayer(
    "https://api.mapbox.com/styles/v1/mapbox/light-v11/tiles/512/{z}/{x}/{y}?access_token=pk.eyJ1Ijoid2lsbGZvcmtlciIsImEiOiJjbDBqdjVvamkwZ2hmM2NtZzhxaWFsdTRkIn0.G6XwHnMeJJzxWbCv1Pihbw",
    {
      maxZoom: 19,
      tileSize: 512,
      zoomOffset: -1,
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, Imagery Â© Mapbox'
    }
  ).addTo(map);

  // Custom marker icon
  const customIcon = L.icon({
    iconUrl: "https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-orange.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34]
  });

  // Google Sheet CSV URL
  const sheetURL = "https://docs.google.com/spreadsheets/d/1GG8JOGhnx5qydOVLIIeISdvl8k9rrb0CHAseKHWfP1Y/gviz/tq?tqx=out:csv&sheet=Sheet1";

  // Load and display markers
  Papa.parse(sheetURL, {
    download: true,
    header: true,
    complete: function(results) {
      results.data.forEach(row => {
        if (row.lat && row.lng) {
          const lat = parseFloat(row.lat);
          const lng = parseFloat(row.lng);
          if (!isNaN(lat) && !isNaN(lng)) {
            L.marker([lat, lng], { icon: customIcon })
              .addTo(map)
              .bindPopup(`<strong>${row.name}</strong><br>${row.info || ""}`);
          }
        }
      });
    }
  });

  // Optional: Add general search/geocoder
  L.Control.geocoder({
    defaultMarkGeocode: true
  }).addTo(map);
</script>
